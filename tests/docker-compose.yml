version: '2'
services:
  influxdb:
    image: influxdb:1.7
    container_name: "influxdb"
    ports:
      - "8086:8086"

  # --------------------------------------------------------------------------
  # Crossbar Server
  # --------------------------------------------------------------------------
  crossbar:
    image: ocs-crossbar
    container_name: "crossbar"
    ports:
      - "8001:8001" # expose for OCS
    volumes:
      - ./config.json:/ocs/.crossbar/config.json
    environment:
         - PYTHONUNBUFFERED=1

  # --------------------------------------------------------------------------
  # OCS Components
  # --------------------------------------------------------------------------
  fake-data1:
    image: ocs-fake-data-agent
    container_name: "fake-data-agent"
    hostname: ocs-docker
    volumes:
      - ./default.yaml:/config/default.yaml:ro
    command:
      - "--instance-id=fake-data1"
      - "--site-hub=ws://crossbar:8001/ws"
      - "--site-http=http://crossbar:8001/call"

  ocs-aggregator:
    image: ocs-aggregator-agent
    hostname: ocs-docker
    volumes:
      - ./default.yaml:/config/default.yaml:ro
      - "./data/:/data"
    environment:
      - LOGLEVEL=debug
